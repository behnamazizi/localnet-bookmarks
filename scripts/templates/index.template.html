<!DOCTYPE html>
<html lang="fa" dir="rtl">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>localnet-bookmarks</title>

        <style>
            /* Base sizing: 1rem = 24px */
            html {
                font-size: 24px;
            }

            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;

                /* Color tokens (all colors live here as variables) */
                --c-bg: #ffffff;
                --c-surface: #ffffff;
                --c-text: #111111;
                --c-muted: #6b7280;
                --c-border: #e5e7eb;
                --c-border-strong: #d1d5db;
                --c-shadow: rgba(0, 0, 0, 0.08);
                --c-shadow-strong: rgba(0, 0, 0, 0.12);
                --c-accent: #2563eb;
                --c-accent-weak: rgba(37, 99, 235, 0.12);
                --c-hover: #f3f4f6;
                --c-input: #ffffff;

                /* Sprite tokens */
                --sprite-url: url("__SPRITE_DATA_URI__");
                --sprite-bg-size: __SPRITE_BG_SIZE__;
            }

            body {
                font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
                background: var(--c-bg);
                color: var(--c-text);
                line-height: 1.25;
            }

            .wrap {
                max-width: 42rem;
                margin: 0 auto;
                padding: 1rem;
            }

            .topbar {
                display: flex;
                align-items: flex-start;
                justify-content: space-between;
                gap: 0.75rem;
                margin-bottom: 0.75rem;
            }

            h1 {
                font-size: 1.1rem;
                letter-spacing: -0.01em;
                line-height: 1.15;
            }

            .muted {
                color: var(--c-muted);
                font-size: 0.58rem;
                margin-top: 0.2rem;
            }

            /* Dropdown (details/summary) */
            details.menu {
                position: relative;
                flex: 0 0 auto;
            }

            details.menu > summary {
                list-style: none;
                cursor: pointer;
                user-select: none;
                border: 1px solid var(--c-border);
                background: var(--c-surface);
                border-radius: 0.6rem;
                padding: 0.4rem 0.55rem;
                font-size: 0.62rem;
                color: var(--c-text);
                box-shadow: 0 0.15rem 0.5rem var(--c-shadow);
            }

            details.menu > summary::-webkit-details-marker {
                display: none;
            }

            details.menu[open] > summary {
                border-color: var(--c-border-strong);
                box-shadow: 0 0.2rem 0.7rem var(--c-shadow-strong);
            }

            .menu-panel {
                position: absolute;
                top: calc(100% + 0.35rem);
                left: 0;
                min-width: 13rem;
                max-width: 18rem;
                background: var(--c-surface);
                border: 1px solid var(--c-border);
                border-radius: 0.75rem;
                box-shadow: 0 0.4rem 1.2rem var(--c-shadow-strong);
                padding: 0.65rem;
                z-index: 50;
            }

            .menu-row {
                display: flex;
                flex-direction: column;
                gap: 0.4rem;
            }

            .menu-title {
                font-size: 0.65rem;
                font-weight: 700;
            }

            .menu-text {
                font-size: 0.58rem;
                color: var(--c-muted);
                line-height: 1.35;
            }

            .menu-links {
                display: flex;
                flex-direction: column;
                gap: 0.3rem;
                margin-top: 0.25rem;
            }

            .menu-links a {
                font-size: 0.62rem;
                color: var(--c-accent);
                text-decoration: none;
                padding: 0.25rem 0.35rem;
                border-radius: 0.45rem;
            }

            .menu-links a:hover {
                background: var(--c-accent-weak);
            }

            /* Controls */
            .controls {
                display: flex;
                gap: 0.5rem;
                flex-wrap: wrap;
                margin: 0.75rem 0 0.75rem;
            }

            .search {
                flex: 1 1 16rem; /* wide search */
                min-width: 12rem;
                border: 1px solid var(--c-border);
                background: var(--c-input);
                border-radius: 0.7rem;
                padding: 0.55rem 0.65rem;
                font-size: 0.7rem;
                outline: none;
                box-shadow: 0 0.15rem 0.5rem var(--c-shadow);
            }

            .search:focus {
                border-color: var(--c-accent);
                box-shadow: 0 0 0 0.12rem var(--c-accent-weak);
            }

            .select {
                flex: 0 0 auto;
                border: 1px solid var(--c-border);
                background: var(--c-input);
                border-radius: 0.7rem;
                padding: 0.55rem 0.65rem;
                font-size: 0.7rem;
                outline: none;
                box-shadow: 0 0.15rem 0.5rem var(--c-shadow);
            }

            .select:focus {
                border-color: var(--c-accent);
                box-shadow: 0 0 0 0.12rem var(--c-accent-weak);
            }

            .stats {
                font-size: 0.58rem;
                color: var(--c-muted);
                margin-bottom: 0.6rem;
            }

            /* Grid cards */
            .grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(14rem, 1fr));
                gap: 0.5rem;
            }

            a.card {
                display: block;
                text-decoration: none;
                color: inherit;
                border: 1px solid var(--c-border);
                background: var(--c-surface);
                border-radius: 0.8rem;
                padding: 0.6rem 0.65rem;
                box-shadow: 0 0.2rem 0.7rem var(--c-shadow);
                transition: transform 120ms ease, box-shadow 120ms ease, border-color 120ms ease, background 120ms ease;
                outline: none;
                min-height: 3.2rem;
            }

            a.card:hover {
                background: var(--c-hover);
                border-color: var(--c-border-strong);
                box-shadow: 0 0.35rem 1rem var(--c-shadow-strong);
                transform: translateY(-0.03rem);
            }

            a.card:focus-visible {
                box-shadow: 0 0 0 0.12rem var(--c-accent-weak), 0 0.35rem 1rem var(--c-shadow-strong);
                border-color: var(--c-accent);
            }

            .row {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                min-width: 0; /* enables ellipsis for text */
            }

            .favicon {
                width: 1rem; /* 24px */
                height: 1rem; /* 24px */
                border-radius: 0.35rem;
                border: 1px solid var(--c-border);
                flex: 0 0 auto;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                overflow: hidden;
                user-select: none;
            }

            .favicon.has-ico {
                background-image: var(--sprite-url);
                background-repeat: no-repeat;
                background-size: var(--sprite-bg-size);
                color: transparent;
                background-color: var(--c-surface);
            }

            .favicon.no-ico {
                background: var(--c-hover);
                color: var(--c-text);
                font-size: 0.55rem;
                font-weight: 800;
            }

            .text {
                min-width: 0;
                flex: 1 1 auto;
                display: flex;
                flex-direction: column;
                gap: 0.15rem;
            }

            .name {
                font-size: 0.72rem;
                font-weight: 750;
                white-space: nowrap; /* no wrap */
                overflow: hidden; /* allow ellipsis */
                text-overflow: ellipsis; /* end with ellipsis */
                line-height: 1.15;
            }

            .url {
                font-size: 0.58rem;
                color: var(--c-muted);
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                direction: ltr; /* URLs read better LTR */
                text-align: left;
            }

            /* Mobile polish */
            @media (max-width: 18rem) {
                .wrap {
                    padding: 0.7rem;
                }
                .grid {
                    grid-template-columns: 1fr;
                }
                .search {
                    flex-basis: 100%;
                }
                details.menu .menu-panel {
                    left: auto;
                    right: 0;
                }
            }
        </style>
    </head>

    <body>
        <div class="wrap">
            <div class="topbar">
                <div>
                    <h1>localnet-bookmarks</h1>
                    <div class="muted">A lightweight offline directory for locally accessible sites.</div>
                </div>

                <details class="menu">
                    <summary>Info</summary>
                    <div class="menu-panel">
                        <div class="menu-row">
                            <div class="menu-title">Build version</div>
                            <div class="menu-text">__BUILD_VERSION__</div>

                            <div class="menu-title" style="margin-top: 0.35rem">About</div>
                            <div class="menu-text">A curated list of locally accessible websites useful during internet restrictions.</div>

                            <div class="menu-links">
                                <a href="https://github.com/behnamazizi/localnet-bookmarks" target="_blank" rel="noreferrer"> GitHub repository </a>
                                <a href="https://github.com/behnamazizi/localnet-bookmarks/releases/latest" target="_blank" rel="noreferrer"> Latest release </a>
                            </div>
                        </div>
                    </div>
                </details>
            </div>

            <div class="controls">
                <input id="q" class="search" type="search" placeholder="جست‌وجو…" />
                <select id="cat" class="select">
                    <option value="">همهٔ دسته‌بندی‌ها</option>
                    __CATEGORIES__
                </select>
            </div>

            <div id="stats" class="stats"></div>
            <div id="grid" class="grid"></div>
        </div>

        <script>
            // Embedded data (generated)
            const SITES = __DATA__;

            const grid = document.getElementById("grid");
            const q = document.getElementById("q");
            const cat = document.getElementById("cat");
            const stats = document.getElementById("stats");

            function norm(s) {
                return (s || "").toString().trim().toLowerCase();
            }

            function firstLetter(name) {
                const s = (name || "").trim();
                return s ? s[0] : "?";
            }

            function render(items) {
                stats.textContent = `نمایش: ${items.length} مورد از ${SITES.length}`;

                grid.innerHTML = items
                    .map((s) => {
                        const hasIcon = s.icon_x !== null && s.icon_x !== undefined && s.icon_y !== null && s.icon_y !== undefined;
                        const favClass = hasIcon ? "has-ico" : "no-ico";
                        const letter = firstLetter(s.name);

                        const style = hasIcon ? `style="background-position:-${s.icon_x}px -${s.icon_y}px;"` : "";

                        return `
          <a class="card" href="${s.url}" target="_blank" rel="noreferrer">
            <div class="row">
              <span class="favicon ${favClass}" ${style}>${hasIcon ? "" : letter}</span>
              <div class="text">
                <div class="name" title="${s.name}">${s.name}</div>
                <div class="url" title="${s.url}">${s.url}</div>
              </div>
            </div>
          </a>
        `;
                    })
                    .join("");
            }

            function apply() {
                const query = norm(q.value);
                const c = cat.value;

                const filtered = SITES.filter((s) => {
                    if (c && (s.category || "") !== c) return false;
                    if (!query) return true;

                    const hay = [s.name, s.url, s.category, ...(s.tags || [])].map(norm).join(" | ");
                    return hay.includes(query);
                });

                render(filtered);
            }

            q.addEventListener("input", apply);
            cat.addEventListener("change", apply);

            render(SITES);
        </script>
    </body>
</html>
